<accordion-item [isOpen]="true">
    <accordion-header>
        <div class="accordion-header-content">
            <div class="accordion-title">
                <ion-icon src="assets/icons/accordian/notes.svg"></ion-icon>
                <div class="accordion-title-content">
                    <div>Tax Clearance of Overseas Payment</div>
                </div>
            </div>
        </div>
    </accordion-header>
    <accordion-body>
        <div class="bg-white-padd">

            <app-tab-sub-group (tabChange)="onChange($event)">
                <app-sub-tab tabTitle="Detail">
                    <div class="outer-content-wrapper">
                        <div class="content-wrapper">
                            <row>
                                <div class="col-md-9">
                                    <row>
                                        <div class="col-md-4"> <view-label label="Assigned Officer"
                                                value="{{application.ientTrustSettlementAssignedOfficerHistory.assignedToFullname}}"></view-label>
                                        </div>
                                        <div class="col-md-4"> <view-label label="Assigned Date"
                                                value="{{application.ientTrustSettlementAssignedOfficerHistory.assignedDate | appDate}}"></view-label>
                                        </div>
                                        <div class="col-md-4">
                                            <!-- <view-label label="TAT"
                                                value=" {{application.ientTrustSettlementAssignedOfficerHistory.tatDays}} Days"></view-label> -->
                                        </div>
                                    </row>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-flex">
                                        @if(this.type.isEditable === 'Y'){
                                        @if(this.application.reassignFlag === 'True'){
                                        <form #p="ngForm" class="col-md-10 w250">
                                            <app-input-control type="select" key="constant" keyName="description"
                                                placeholder="Officer" [items]="assignedOfficerDDL"
                                                defaultOption="--Select--"
                                                [(ngModel)]="trustSettlementAssignedOfficer.assignedTo"
                                                name="assignedTo"></app-input-control>
                                        </form>
                                        <div class="col-md-2"><app-icon-button name="reassign" (click)="reAssignTrust()"
                                                toolTip="Reassign"></app-icon-button></div>
                                        }
                                        @if(this.application.selfassignFlag ===' True'){
                                        <div class="col-md-2"><app-icon-button name="add" (click)="selfAssignTrust()"
                                                toolTip="Self Assign"></app-icon-button></div>
                                        }
                                        }
                                    </div>
                                </div>
                            </row>
                            <div class="mb20 "></div>
                            <!-- <div class="box">
                                <row>

                                    <div class="col-md-4 border-right">
                                        <div class="view-label-container-title mb26">
                                            <div
                                                class="view-label-container-title d-flex pt10 gap-10 align-items-center">
                                                <ion-icon name="person-outline" class="pr5"></ion-icon>
                                                Overseas Address
                                            </div>
                                        </div>
                                        <div class="p10">
                                            <view-label label="Line 1" [value]="application.iOverseasAddress.line1"
                                                class="pb10"></view-label>
                                            <view-label label="Line 2" [value]="application.iOverseasAddress.line2"
                                                class="pb10"></view-label>
                                            <view-label label="Line 3" [value]="application.iOverseasAddress.line3"
                                                class="pb10"></view-label>
                                            <view-label label="Province"
                                                [value]="application.iOverseasAddress.provinceDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Island"
                                                [value]="application.iOverseasAddress.islandDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Tikina"
                                                [value]="application.iOverseasAddress.tikinaDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Village"
                                                [value]="application.iOverseasAddress.village"
                                                class="pb10"></view-label>
                                            <view-label label="Po Box No" [value]="application.iOverseasAddress.line1"
                                                class="pb10"></view-label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 border-right">
                                        <div class="view-label-container-title mb26">
                                            <div
                                                class="view-label-container-title pt10 gap-10 d-flex align-items-center">
                                                <ion-icon name="person-outline" class="pr5"></ion-icon>
                                                Overseas Bank Details
                                            </div>
                                        </div>
                                        <div class="p10">
                                            <view-label label="Account No"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.accountNumber"
                                                class="pb10"></view-label>
                                            <view-label label="Bank Name"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.bankName"
                                                class="pb10"></view-label>
                                            <view-label label="Bank Code"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.bankCode"
                                                class="pb10"></view-label>
                                            <view-label label="Branch"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.bankBranch"
                                                class="pb10"></view-label>

                                        </div>
                                    </div>
                                    <div class="col-md-4 ">
                                        <div class="view-label-container-title mb26">
                                            <div
                                                class="view-label-container-title pt10 gap-10 d-flex align-items-center">
                                                <ion-icon name="person-outline" class="pr5"></ion-icon>
                                                Overseas Bank Address
                                            </div>
                                        </div>
                                        <div class="p10">
                                            <view-label label="Line 1"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.line1"
                                                class="pb10"></view-label>
                                            <view-label label="Line 2"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.line2"
                                                class="pb10"></view-label>
                                            <view-label label="Line 3"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.line3"
                                                class="pb10"></view-label>
                                            <view-label label="Province"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.provinceDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Island"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.islandDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Tikina"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.tikinaDescription"
                                                class="pb10"></view-label>
                                            <view-label label="Village"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.village"
                                                class="pb10"></view-label>
                                            <view-label label="Po Box No"
                                                [value]="application.ientTrustSettlementApplicationBankDetail.ibankAddress.poBoxNo"
                                                class="pb10"></view-label>
                                        </div>
                                    </div>
                                </row>
                            </div> -->
                            <div class="mb20"></div>

                            <!-- @if( application.actionStatusValue==='PENAP'){
                            <form #legalApproveForm="ngForm" class="d-flex align-items-center">
                                <div class="col-md-3 pl15">

                                    <app-input-control [items]="initialData.DDLValues.DDLLegalServiceOfficer"
                                        key="constant" type="select" keyName="description" defaultOption="--Select--"
                                        [errorTrue]="errorTrue" [required]="true"
                                        [(ngModel)]="application.legalServiceOfficerId" name="legalServiceOfficerId"
                                        label="Assigned Legal Officer"></app-input-control>
                                </div>
                             <div class="col-md-1 ">
                                    <app-icon-button name="accept" toolTip="Accept"
                                        (click)="courtOrderLegalApprove()"></app-icon-button>
                                </div
                            </form>
                            } -->
                            <!-- @if(application.actionStatusValue === 'APROV'){ -->

                            <row>
                                <div class="col-md-7">
                                    <div class="outer-content-wrapper">
                                        <div class="content-wrapper">
                                            <div class="h280">
                                                <!-- @if (loading) { -->
                                                <div class="col-md-12">

                                                    <app-table [columns]="courtOrderColumns"
                                                        [columnsName]="courtOrderColumnsName"
                                                        [dataSource]="application.lstentTrustSettlementAssignedOfficerHistory  | trustSettlementPipe: this.type.trustSettlementApplicationStageValue: this.type.identificationNo"
                                                        [hideSelectAll]="true" [showPaginator]="false"
                                                        columnID="trustApplicationDocumentId">
                                                        <ng-template cellDef="verificationDate" let-element>
                                                            {{element.verifiedDate | appDate}}
                                                        </ng-template>
                                                        <ng-template cellDef="action" let-element let-index="index">
                                                            @if((application.lstentTrustSettlementAssignedOfficerHistory  | trustSettlementPipe: this.type.trustSettlementApplicationStageValue: this.type.identificationNo).length === (index + 1)){
                                                            @if(this.type.isEditable === 'Y'){
                                                            <app-icon-button name="open" toolTip="Open"
                                                                (click)="createNotesDialog()"></app-icon-button>
                                                            }
                                                        }
                                                        @else {
                                                            <span></span>
                                                        }
                                                        </ng-template>
                                                    </app-table>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-5 mb20">
                                    <div class="box" style="padding: 8px 16px;">
                                        <div class="mb20"></div>
                                        <app-drop-zone type="1" [fileType]="fileExtension" [accept]="accept"
                                            [btnClicked]="this.type.isEditable === 'N'" [multiple]="false"
                                            (onUpload)="uploadCourtDocumentAttachment($event)"></app-drop-zone>

                                    </div>
                                    <div class="single-document">
                                        <div class="title">Uploaded Document</div>

                                        @for
                                        (item of
                                        application.lstentTrustSettlementApplicationDocument | trustSettlementPipe:
                                        this.type.trustSettlementApplicationStageValue: this.type.identificationNo;
                                        track $index) {

                                        <row>
                                            <div class="col-md-6 pl8 mb20"><view-label label="File Name"
                                                    value="{{item?.ientFile?.fileName}}"></view-label>
                                            </div>
                                            <div class="col-md-6 pl8 mb20"><view-label label="File Size"
                                                    value="{{item?.ientFile?.fileSize | fileSize}} MB"></view-label>
                                            </div>
                                            <div class="col-md-6 pl8 mb20"> <view-label label="Format"
                                                    value="{{item?.ientFile?.fileExtension   }}"></view-label>
                                            </div>
                                            @if(item?.ientFile?.fileName
                                            !==''){
                                            <div class="col-md-4 d-flex">
                                                <app-icon-button name="doc-view" toolTip="View"
                                                    (click)="viewFile(item)">
                                                    <!--   -->
                                                </app-icon-button>
                                                <app-icon-button name="doc-download" toolTip="Download"
                                                    (click)="downloadFile(item)">
                                                    <!--  (click)="downloadFile(this.application.lstentTrustSettlementApplicationDocument[0])" -->
                                                </app-icon-button>
                                                @if(this.type.isEditable === 'Y'){
                                                <app-icon-button name="doc-delete" toolTip="Delete"
                                                    (click)="checkDocumentDelete(item)">
                                                    <!-- (click)="checkDocumentDelete(this.application.lstentTrustSettlementApplicationDocument[0])" -->
                                                </app-icon-button>
                                                }
                                            </div>
                                            }
                                        </row>
                                        }
                                    </div>
                                </div>
                                <!-- <div class="col-md-7">
                                    <form #notiForm="ngForm">
                                        <app-input-control type="textarea" className="notes-1" [errorTrue]="errorTrue"
                                            [(ngModel)]="notesMessage" name="notesMessage" [maxLength]="250"
                                            [required]="true" label="Notes"></app-input-control>
                                    </form>
                                    <div class="end gap-10 mb26">
                                        @if(this.type.isEditable === 'Y'){
                                        <app-icon-button name="save" toolTip="Save"
                                            (click)="saveTrustApplicationNotes()"></app-icon-button>
                                        }

                                    </div>
                                     <app-table [pagination]="pagination" [columns]="clientDocumentColumns"
                                        [columnsName]="clientDocumentColumnsName" [hideSelectAll]="true"
                                        [dataSource]="application.lstentTrustSettlementApplicationDocument" [showPaginator]="false"
                                        columnID="trustApplicationDocumentId">
                                        <ng-template cellDef="fileName" let-element>
                                            {{element.ientFile.fileName}}
                                        </ng-template>
                                        <ng-template cellDef="fileExtension" let-element>
                                            {{element.ientFile.fileExtension}}
                                        </ng-template>
                                        <ng-template cellDef="fileSize" let-element>
                                            {{element.ientFile.fileSize | fileSize}}mb
                                        </ng-template>
                                        <ng-template cellDef="action" let-element>
                                            @if(element.ientFile.fileName!==''){

                                            <div class="d-flex align-items-center">
                                                <app-icon-button name="doc-download"
                                                    (click)="downloadFile(element)"></app-icon-button>
                                                <app-icon-button name="doc-delete"
                                                    (click)="checkDocumentDelete(element)"></app-icon-button>
                                            </div>
                                            }
                                        </ng-template>
                                    </app-table>

                                </div>
                                <div class="pb10"></div>

                               <div class="horizontal-tab hori-active w100px">Notes</div>
                                <div class="border p10">

                                    <div class="justify-content-end d-flex">
                                        <app-icon-button name="add" toolTip="Create"
                                            (click)="createNotesDialog()"></app-icon-button>
                                    </div>
                                    <div class="p16px"></div>
                                    <div class="notes-list">
                                        @for (item of notesList; track $index) {
                                        <div class="border-bottom notes-list">
                                            <div class="mx10 notes-desc">{{item.notes}}</div>
                                            <div class="d-flex justify-content-end notes-context">
                                                <div style="padding-right:5px ;">
                                                    {{item.enteredByFullname}}</div>
                                                <div class=" notes-border-left">
                                                    {{item.enteredDate |appDate}} {{item.enteredDate |appDate: 'hh:mm
                                                    a'}}
                                                </div>
                                                <div style="padding-right:5px ;"></div>
                                                <div class=" notes-border-left status-{{item.statusValue}}">
                                                    {{item.statusDescription}}
                                                </div>
                                                <div class="card-1-header-label px-2 ">

                                                </div>
                                            </div>
                                        </div>
                                        }
                                    </div>
                                </div> -->



                            </row>
                            <!-- } -->

                        </div>
                    </div>

                </app-sub-tab>
                <app-sub-tab tabTitle="Linked Document">
                    <div class="outer-content-wrapper">
                        <div class="content-wrapper">
                            <app-table [columns]="linkedColumns" [columnsName]="linkedColumnsName"
                                [hideSelectAll]="true" [hasPagination]="true" [dataSource]="tableLinkedData">
                                <ng-template cellDef="action" let-element>
                                    <app-icon-button name="doc-download"
                                        (click)="downloadLinkedFile(element)"></app-icon-button>
                                </ng-template>
                            </app-table>
                        </div>
                    </div>
                </app-sub-tab>

            </app-tab-sub-group>
            <div class="col-md-12 end">
                @if(this.type.isEditable === 'Y' && application.assignedOfficerFlag === 'True'){
                <button type="submit" class="approve-btn" (click)="completeApplicationStage()">Complete</button>
                }
            </div>
        </div>
    </accordion-body>
</accordion-item>

<ng-template #Template>
    <div class="ab bgc">
        <div class="rel">
            <div class="p-fix d-flex">
                <div class="download-button">
                    <button color="primary" (click)="downloadImageFile()">
                        Download
                    </button>
                </div>
                <div class="close-button">
                    <button color="danger" (click)="dialog.closeDialog()">
                        Close
                    </button>
                </div>

            </div>
            <div class="d-flex align-items-center h100 justify-content-center w100">
                <div class="d-flex align-items-center h100 justify-content-center w100 relative">
                    <div class="ab">
                        <div class="rel">
                            <div class="dis-none wcheck active">
                                <img [src]="filePath" alt="PreviewImages">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #notesDialog>
    <div class="dialog-container">
        <div class="dialog-header">
            <div class="dialog-title">
                <ion-icon class="fos-20" src="assets/icons/finance.svg"></ion-icon>
                Trust Settlement Application > Detail > Add Notes
            </div>
            <div class="slot-right">
                <div class="btn-group">
                    <app-icon-button name="save" toolTip="Save" (click)="saveNotes()"></app-icon-button>
                    <app-icon-button name="clear" toolTip="Clear" (click)="clearNotes()"></app-icon-button>
                    <app-icon-button name="close" toolTip="Close" (click)="dialogClose()"></app-icon-button>
                </div>
            </div>
        </div>
        <div class="dialog-content">
            <div class="dialog-content-inner h100">
                @if(data.showErrorMessage){
                <div class="error-panel">
                    <app-error-message></app-error-message>
                </div>
                }
                <form #x="ngForm">
                    <row>
                        <div class="col-md-4">
                            <app-input-control label="Action Status" type="select"
                                [(ngModel)]="trustSettlementNotes.actionStatusValue" defaultOption="--Select--"
                                [items]="actionStatusDDL" key="constant" keyName="description" name="actionStatusValue"
                                [errorTrue]="errorTrue" [required]="true"></app-input-control>
                        </div>
                        <div class="col-md-4">
                            <!-- <app-input-control label="Application Status" type="select" defaultOption="All"
                                [(ngModel)]="trustSettlementNotes.statusValue" name="statusValue" [items]="appStatusDDL"
                                key="constant" keyName="description" [errorTrue]="errorTrue"
                                [required]="true"></app-input-control> -->
                                <view-label label="Application Status" value="{{application.statusDescription
                                }}"></view-label>
                        </div>
                        <div class="col-md-4">
                            <view-label label="Application Stage"
                                value="{{application.applicationStageDescription}}"></view-label>
                        </div>
                        <div class="col-md-12 mb26">
                            <app-input-control type="textarea" className="notes" [errorTrue]="errorTrue"
                                [(ngModel)]="notesMessage" name="notesMessage" [maxLength]="250" [required]="true"
                                label="Notes"></app-input-control>
                        </div>
                    </row>
                </form>
            </div>
        </div>
    </div>
</ng-template>
